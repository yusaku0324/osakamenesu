---
version: "3"

includes:
  core: ./core.yml
  venv: ./venv.yml
  tests: ./tests.yml

tasks:
  #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # â‘  äº‹å‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆworktree-1 ã§ pytestï¼‰
  #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  validate:
    desc: "local dry-run: pytest in ai-task-1"
    deps: [tests:impl-cdp, tests:create-fixtures]
    cmds:
      - |
        cd ../ai-task-1
        source .venv/bin/activate
        pytest -q
        deactivate

  #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # â‘¡ Git ã‚³ãƒŸãƒƒãƒˆ & ãƒ—ãƒƒã‚·ãƒ¥
  #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  git:commit:
    desc: "commit task split & CDP impl"
    cmds:
      - |
        git add tasks/ *.yml
        git commit -m "task split & CDP impl: all tests green"

  git:push:
    desc: "push current branch"
    cmds: [git push]

  #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # â‘¢ CI ã¨åŒç­‰ã®ãƒ•ãƒ«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
  #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  pipeline:local:
    desc: "validate â†’ cursor auto â†’ parallel run â†’ pick (sequential)"
    cmds:
      - task flow:validate
      - task cursor:auto
      - task parallel:run
      - task parallel:pick
      - echo "ğŸ‰  local pipeline finished (green)"

  #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # â‘£ ãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼šã‚³ãƒŸãƒƒãƒˆ â†’ ãƒ—ãƒƒã‚·ãƒ¥ â†’ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
  #â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  commit-and-pipeline:
    desc: "git commit & push, then local pipeline"
    deps: [git:commit, git:push, pipeline:local]
    cmds:
      - echo "âœ…  all done"
