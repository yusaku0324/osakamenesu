name: è‡ªå‹•é–‹ç™ºãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

on:
  schedule:
    - cron: '0 */6 * * *'  # 6æ™‚é–“ã”ã¨ã«å®Ÿè¡Œ
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
  push:
    branches:
      - main
    paths:
      - 'scripts/auto_enhance.py'
      - '.github/workflows/auto-development.yml'

jobs:
  auto-develop:
    runs-on: ubuntu-latest
    
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Python ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest pytest-cov black flake8
      
      - name: è‡ªå‹•æ©Ÿèƒ½æ‹¡å¼µã®å®Ÿè¡Œ
        run: |
          python scripts/auto_enhance.py
      
      - name: ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
        run: |
          black --check .
          flake8 . --max-line-length=100
      
      - name: ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
        run: |
          python -m pytest tests/ -v --cov=./ --cov-report=xml
      
      - name: å¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆ
        run: |
          git config --global user.name "Auto Developer Bot"
          git config --global user.email "bot@x-dm-bot.com"
          git add .
          git diff --staged --quiet || git commit -m "ğŸ¤– è‡ªå‹•æ©Ÿèƒ½è¿½åŠ : $(date +'%Y-%m-%d %H:%M:%S')"
          git push || echo "å¤‰æ›´ãªã—"
      
      - name: å“è³ªãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
        if: always()
        run: |
          python scripts/generate_quality_report.py
      
      - name: Slack é€šçŸ¥
        if: always()
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: 'è‡ªå‹•é–‹ç™ºãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Œäº†ã—ã¾ã—ãŸ'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}